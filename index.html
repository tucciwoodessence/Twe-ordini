<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWE - Sistema Preventivazione/Ordine</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .icon { width: 16px; height: 16px; display: inline-block; vertical-align: middle; }
        .icon-plus:after { content: "+"; font-weight: bold; }
        .icon-trash:after { content: "üóë"; }
        .icon-eye:after { content: "üëÅ"; }
        .icon-x:after { content: "‚úï"; font-weight: bold; }
        .icon-calc:after { content: "üßÆ"; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const DoorOrderGenerator = () => {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [password, setPassword] = useState('');
          
          const [orderInfo, setOrderInfo] = useState({
            nomeCommessa: '',
            numeroOrdine: '',
            nomeAgente: '',
            nomeCliente: '',
            indirizzoConsegna: '',
            partitaIva: '',
            costoTrasporto: 0,
            altriExtra: []
          });

          const [doors, setDoors] = useState([]);
          const [currentDoor, setCurrentDoor] = useState({
            posizione: '',
            stanza: '',
            modelloPorta: '',
            prezzoBaseModello: 0,
            scontisticaModello: 0,
            finitura: '',
            prezzoFinitura: 0,
            larghezza: '',
            altezza: '',
            spessoreMuro: '',
            fuoriMisuraLarghezza: 0,
            fuoriMisuraAltezza: 0,
            fuoriMisuraSpessore: 0,
            apertura: '',
            sistemaCerniere: '',
            prezzoCerniere: 0,
            finituraFerramenta: '',
            prezzoFerramenta: 0,
            quantita: 1,
            note: ''
          });

          const [showPreview, setShowPreview] = useState(false);
          const [includePricesInPDF, setIncludePricesInPDF] = useState(true);

          const aperturaOptions = ['Spinta a destra', 'Spinta a sinistra'];
          const sistemaCerniereOptions = [
            'Anuba', 'Scorrevole interno muro', 'Scorrevole esterno muro', 
            'Cerniere a scomparsa', 'Cerniere pivot', 'Libro simmetrico', 
            'Libro asimmetrico', 'Libro Celegon 90¬∞', 'Libro Celegon 180¬∞', 
            'Rototraslante', 'Binario invisibile Magic'
          ];
          const finituraFerramentaOptions = ['Cromo satinato', 'Bianco', 'Nero', 'Altro'];

          // Autenticazione
          const authenticate = () => {
            if (password === 'twe2024!') {
              setIsAuthenticated(true);
            } else {
              alert('Password non corretta');
              setPassword('');
            }
          };

          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                  <div className="text-center mb-8">
                    <div className="text-4xl font-light mb-2" style={{fontFamily: 'serif'}}>twe</div>
                    <div className="text-xs tracking-widest uppercase mb-4">TUCCI WOOD ESSENCE</div>
                    <div className="text-lg text-gray-600">Accesso Riservato</div>
                  </div>
                  <div className="space-y-4">
                    <input
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && authenticate()}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none"
                      placeholder="Inserisci password"
                    />
                    <button
                      onClick={authenticate}
                      className="w-full bg-black text-white font-light py-4 px-6 hover:bg-gray-800 transition-colors uppercase tracking-wide text-sm"
                    >
                      Accedi
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          const handleOrderInfoChange = (field, value) => {
            setOrderInfo({ ...orderInfo, [field]: value });
          };

          const addExtraItem = () => {
            setOrderInfo({
              ...orderInfo,
              altriExtra: [...orderInfo.altriExtra, { id: Date.now(), descrizione: '', prezzo: 0 }]
            });
          };

          const updateExtraItem = (id, field, value) => {
            setOrderInfo({
              ...orderInfo,
              altriExtra: orderInfo.altriExtra.map(item =>
                item.id === id ? { ...item, [field]: value } : item
              )
            });
          };

          const removeExtraItem = (id) => {
            setOrderInfo({
              ...orderInfo,
              altriExtra: orderInfo.altriExtra.filter(item => item.id !== id)
            });
          };

          const handleInputChange = (field, value) => {
            setCurrentDoor({ ...currentDoor, [field]: value });
          };

          const calculateDoorPrice = (door) => {
            const prezzoBase = parseFloat(door.prezzoBaseModello) || 0;
            const sconto = parseFloat(door.scontisticaModello) || 0;
            const prezzoFinitura = parseFloat(door.prezzoFinitura) || 0;
            const prezzoCerniere = parseFloat(door.prezzoCerniere) || 0;
            const prezzoFerramenta = parseFloat(door.prezzoFerramenta) || 0;
            const fuoriMisuraL = parseFloat(door.fuoriMisuraLarghezza) || 0;
            const fuoriMisuraA = parseFloat(door.fuoriMisuraAltezza) || 0;
            const fuoriMisuraS = parseFloat(door.fuoriMisuraSpessore) || 0;
            
            const prezzoBaseConSconto = prezzoBase * (1 - sconto / 100);
            const prezzoTotalePorta = prezzoBaseConSconto + prezzoFinitura + prezzoCerniere + prezzoFerramenta + fuoriMisuraL + fuoriMisuraA + fuoriMisuraS;
            
            return prezzoTotalePorta * (parseInt(door.quantita) || 1);
          };

          const calculateOrderTotal = () => {
            const totaleDoors = doors.reduce((sum, door) => sum + calculateDoorPrice(door), 0);
            const costoTrasporto = parseFloat(orderInfo.costoTrasporto) || 0;
            const totaleExtra = orderInfo.altriExtra.reduce((sum, extra) => sum + (parseFloat(extra.prezzo) || 0), 0);
            return totaleDoors + costoTrasporto + totaleExtra;
          };

          const addDoor = () => {
            if (!currentDoor.posizione || !currentDoor.stanza || !currentDoor.modelloPorta) {
              alert('Compilare almeno Posizione, Stanza e Modello Porta');
              return;
            }
            
            setDoors([...doors, { ...currentDoor, id: Date.now() }]);
            setCurrentDoor({
              posizione: '', stanza: '', modelloPorta: '', prezzoBaseModello: 0, scontisticaModello: 0,
              finitura: '', prezzoFinitura: 0, larghezza: '', altezza: '', spessoreMuro: '',
              fuoriMisuraLarghezza: 0, fuoriMisuraAltezza: 0, fuoriMisuraSpessore: 0,
              apertura: '', sistemaCerniere: '', prezzoCerniere: 0,
              finituraFerramenta: '', prezzoFerramenta: 0, quantita: 1, note: ''
            });
          };

          const removeDoor = (id) => {
            setDoors(doors.filter(door => door.id !== id));
          };

          const formatCurrency = (value) => {
            return new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(value);
          };

          const generateOrder = (includePrices = true) => {
            if (doors.length === 0) {
              alert('Aggiungere almeno una porta all\'ordine');
              return;
            }
            
            const formatPrice = (value) => {
              return new Intl.NumberFormat('it-IT', {
                style: 'currency',
                currency: 'EUR'
              }).format(value);
            };
            
            const docTitle = includePrices ? 'PREVENTIVO/ORDINE PORTE DA INTERNO' : 'ORDINE PRODUZIONE PORTE DA INTERNO';
            const fileName = includePrices ? 'TWE-Preventivo' : 'TWE-Produzione';
            
            const orderHtml = `<!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>${docTitle}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 15px; }
            .logo { font-size: 36px; font-family: serif; margin-bottom: 5px; }
            .company { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
            .title { font-size: 18px; margin-top: 15px; }
            .info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; padding: 15px; background: #f9f9f9; }
            .door { border: 1px solid #ddd; margin: 15px 0; padding: 15px; }
            .door-header { font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; }
            .summary { margin-top: 30px; padding: 15px; background: #f0f0f0; }
            .total { font-weight: bold; font-size: 18px; color: #2563eb; }
            .no-prices { color: #666; font-style: italic; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo">twe</div>
            <div class="company">TUCCI WOOD ESSENCE</div>
            <div class="title">${docTitle}</div>
          </div>
          
          <div class="info">
            <div>
              <h4>Dati Ordine</h4>
              <div>Commessa: ${orderInfo.nomeCommessa || '[Da completare]'}</div>
              <div>Numero: ${orderInfo.numeroOrdine || 'TWE-' + Date.now()}</div>
              <div>Agente: ${orderInfo.nomeAgente || '[Da completare]'}</div>
              <div>Data: ${new Date().toLocaleDateString('it-IT')}</div>
            </div>
            <div>
              <h4>Dati Cliente</h4>
              <div>Cliente: ${orderInfo.nomeCliente || '[Da completare]'}</div>
              <div>Indirizzo: ${orderInfo.indirizzoConsegna || '[Da completare]'}</div>
              <div>P.IVA: ${orderInfo.partitaIva || '[Da completare]'}</div>
            </div>
          </div>
          
          ${doors.map((door, index) => `
            <div class="door">
              <div class="door-header">
                <span>PORTA ${index + 1} - ${door.posizione} (${door.stanza})</span>
                ${includePrices ? `<span>${formatPrice(calculateDoorPrice(door))}</span>` : '<span class="no-prices">Prezzi riservati</span>'}
              </div>
              <div>Modello: ${door.modelloPorta} | Qty: ${door.quantita}</div>
              ${door.finitura ? `<div>Finitura: ${door.finitura}</div>` : ''}
              ${door.larghezza && door.altezza ? `<div>Dimensioni: ${door.larghezza} x ${door.altezza} cm</div>` : ''}
              ${door.spessoreMuro ? `<div>Spessore muro: ${door.spessoreMuro} cm</div>` : ''}
              ${door.apertura ? `<div>Apertura: ${door.apertura}</div>` : ''}
              ${door.sistemaCerniere ? `<div>Sistema cerniere: ${door.sistemaCerniere}</div>` : ''}
              ${door.finituraFerramenta ? `<div>Finitura ferramenta: ${door.finituraFerramenta}</div>` : ''}
              ${door.note ? `<div>Note: ${door.note}</div>` : ''}
            </div>
          `).join('')}
          
          <div class="summary">
            ${includePrices ? `
              <div>Subtotale porte: ${formatPrice(doors.reduce((sum, door) => sum + calculateDoorPrice(door), 0))}</div>
              ${orderInfo.costoTrasporto > 0 ? `<div>Trasporto: ${formatPrice(parseFloat(orderInfo.costoTrasporto))}</div>` : ''}
              ${orderInfo.altriExtra.map(extra => extra.prezzo > 0 ? `<div>${extra.descrizione}: ${formatPrice(parseFloat(extra.prezzo))}</div>` : '').join('')}
              <div class="total">TOTALE: ${formatPrice(calculateOrderTotal())}</div>
            ` : `
              <div class="no-prices">DOCUMENTO PRODUZIONE - Prezzi non inclusi</div>
              <div><strong>Totale porte da produrre: ${doors.reduce((sum, door) => sum + parseInt(door.quantita || 1), 0)}</strong></div>
              <div><strong>Totale articoli: ${doors.length}</strong></div>
            `}
          </div>
          
          <div style="margin-top: 30px; text-align: center; font-size: 12px;">
            <strong>TUCCI WOOD ESSENCE</strong><br>www.tucciwoodessence.com
          </div>
        </body>
        </html>`;

            const blob = new Blob([orderHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}-${new Date().toLocaleDateString('it-IT').replace(/\//g, '-')}.html`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            const printWindow = window.open('', '_blank');
            if (printWindow) {
              printWindow.document.write(orderHtml);
              printWindow.document.close();
              printWindow.onload = function() {
                printWindow.document.title = `${fileName}-${new Date().toLocaleDateString('it-IT').replace(/\//g, '-')}`;
                setTimeout(() => {
                  printWindow.print();
                }, 500);
              };
            } else {
              alert('Il popup √® stato bloccato dal browser. Il file √® stato scaricato automaticamente.');
            }
          };

          return (
            <div className="min-h-screen bg-gray-50">
              <header className="bg-white border-b border-gray-200">
                <div className="max-w-7xl mx-auto px-8 py-8">
                  <div className="flex items-center justify-between">
                    <div className="flex flex-col items-start">
                      <div className="text-5xl font-light text-black mb-4" style={{fontFamily: 'serif'}}>
                        twe
                      </div>
                      <div className="text-xs font-normal text-black tracking-widest uppercase">
                        TUCCI WOOD ESSENCE
                      </div>
                    </div>
                    <div className="text-right">
                      <div className="text-sm font-light text-gray-600">
                        Sistema Preventivazione/Ordine
                      </div>
                      <button
                        onClick={() => setIsAuthenticated(false)}
                        className="mt-2 text-xs text-gray-400 hover:text-black"
                      >
                        Logout
                      </button>
                    </div>
                  </div>
                </div>
              </header>

              <div className="max-w-7xl mx-auto px-8 py-12">
                <div className="bg-white p-8 mb-8 border border-gray-200">
                  <h2 className="text-2xl font-light text-black mb-6">Dati ordine</h2>
                  <div className="w-12 h-px bg-black mb-6"></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <input
                      type="text"
                      value={orderInfo.nomeCommessa}
                      onChange={(e) => handleOrderInfoChange('nomeCommessa', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Nome commessa *"
                    />
                    <input
                      type="text"
                      value={orderInfo.numeroOrdine}
                      onChange={(e) => handleOrderInfoChange('numeroOrdine', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Numero ordine"
                    />
                    <input
                      type="text"
                      value={orderInfo.nomeAgente}
                      onChange={(e) => handleOrderInfoChange('nomeAgente', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Nome agente *"
                    />
                    <input
                      type="text"
                      value={orderInfo.nomeCliente}
                      onChange={(e) => handleOrderInfoChange('nomeCliente', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Nome cliente *"
                    />
                    <input
                      type="text"
                      value={orderInfo.indirizzoConsegna}
                      onChange={(e) => handleOrderInfoChange('indirizzoConsegna', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Indirizzo consegna"
                    />
                    <input
                      type="text"
                      value={orderInfo.partitaIva}
                      onChange={(e) => handleOrderInfoChange('partitaIva', e.target.value)}
                      className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                      placeholder="Partita IVA"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 xl:grid-cols-4 gap-8">
                  <div className="xl:col-span-3 bg-white p-8">
                    <h2 className="text-2xl font-light text-black mb-6">Nuova porta</h2>
                    <div className="w-12 h-px bg-black mb-8"></div>
                    
                    <div className="space-y-6">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input
                          type="text"
                          value={currentDoor.posizione}
                          onChange={(e) => handleInputChange('posizione', e.target.value)}
                          className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                          placeholder="Posizione *"
                        />
                        <input
                          type="text"
                          value={currentDoor.stanza}
                          onChange={(e) => handleInputChange('stanza', e.target.value)}
                          className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                          placeholder="Stanza *"
                        />
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Modello porta *
                          </label>
                          <input
                            type="text"
                            value={currentDoor.modelloPorta}
                            onChange={(e) => handleInputChange('modelloPorta', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="Modello porta *"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Prezzo base (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.prezzoBaseModello}
                            onChange={(e) => handleInputChange('prezzoBaseModello', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Sconto (%)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.scontisticaModello}
                            onChange={(e) => handleInputChange('scontisticaModello', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0"
                            min="0"
                            max="100"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Quantit√†
                          </label>
                          <input
                            type="number"
                            value={currentDoor.quantita}
                            onChange={(e) => handleInputChange('quantita', parseInt(e.target.value) || 1)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="1"
                            min="1"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Finitura
                          </label>
                          <input
                            type="text"
                            value={currentDoor.finitura}
                            onChange={(e) => handleInputChange('finitura', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="Rovere, Laccato bianco..."
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Prezzo finitura (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.prezzoFinitura}
                            onChange={(e) => handleInputChange('prezzoFinitura', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Larghezza (cm)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.larghezza}
                            onChange={(e) => handleInputChange('larghezza', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="80"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Altezza (cm)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.altezza}
                            onChange={(e) => handleInputChange('altezza', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="210"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Spessore (cm)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.spessoreMuro}
                            onChange={(e) => handleInputChange('spessoreMuro', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="10"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Fuori misura larghezza (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.fuoriMisuraLarghezza}
                            onChange={(e) => handleInputChange('fuoriMisuraLarghezza', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Fuori misura altezza (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.fuoriMisuraAltezza}
                            onChange={(e) => handleInputChange('fuoriMisuraAltezza', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Fuori misura spessore (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.fuoriMisuraSpessore}
                            onChange={(e) => handleInputChange('fuoriMisuraSpessore', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-light text-black mb-4 uppercase tracking-wide">Apertura</label>
                        <div className="grid grid-cols-2 gap-4">
                          {aperturaOptions.map(option => (
                            <label key={option} className="flex items-center p-4 border border-gray-300 cursor-pointer hover:border-gray-400">
                              <input
                                type="radio"
                                name="apertura"
                                value={option}
                                checked={currentDoor.apertura === option}
                                onChange={(e) => handleInputChange('apertura', e.target.value)}
                                className="mr-4"
                              />
                              <span className="text-black font-light">{option}</span>
                            </label>
                          ))}
                        </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Sistema cerniere
                          </label>
                          <select
                            value={currentDoor.sistemaCerniere}
                            onChange={(e) => handleInputChange('sistemaCerniere', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                          >
                            <option value="">Seleziona sistema cerniere</option>
                            {sistemaCerniereOptions.map(option => (
                              <option key={option} value={option}>{option}</option>
                            ))}
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Prezzo cerniere (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.prezzoCerniere}
                            onChange={(e) => handleInputChange('prezzoCerniere', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                          <label className="block text-sm font-light text-black mb-4 uppercase tracking-wide">Finitura ferramenta</label>
                          <div className="grid grid-cols-2 gap-4">
                            {finituraFerramentaOptions.map(option => (
                              <label key={option} className="flex items-center p-3 border border-gray-300 cursor-pointer hover:border-gray-400">
                                <input
                                  type="radio"
                                  name="finituraFerramenta"
                                  value={option}
                                  checked={currentDoor.finituraFerramenta === option}
                                  onChange={(e) => handleInputChange('finituraFerramenta', e.target.value)}
                                  className="mr-3"
                                />
                                <span className="text-black font-light text-sm">{option}</span>
                              </label>
                            ))}
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                            Prezzo ferramenta (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            value={currentDoor.prezzoFerramenta}
                            onChange={(e) => handleInputChange('prezzoFerramenta', e.target.value)}
                            className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                            placeholder="0.00"
                            step="0.01"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                          Note
                        </label>
                        <textarea
                          value={currentDoor.note}
                          onChange={(e) => handleInputChange('note', e.target.value)}
                          rows={4}
                          className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black resize-none"
                          placeholder="Note aggiuntive..."
                        />
                      </div>

                      {(currentDoor.prezzoBaseModello > 0 || currentDoor.prezzoFinitura > 0 || currentDoor.prezzoCerniere > 0 || currentDoor.prezzoFerramenta > 0 || currentDoor.fuoriMisuraLarghezza > 0 || currentDoor.fuoriMisuraAltezza > 0 || currentDoor.fuoriMisuraSpessore > 0) && (
                        <div className="bg-gray-50 p-6 border border-gray-300">
                          <h4 className="text-sm font-light text-black mb-4 uppercase tracking-wide flex items-center">
                            <span className="icon icon-calc mr-2"></span>
                            Anteprima prezzo porta
                          </h4>
                          <div className="space-y-2 text-sm">
                            <div className="flex justify-between">
                              <span>Prezzo base:</span>
                              <span>{formatCurrency(parseFloat(currentDoor.prezzoBaseModello) || 0)}</span>
                            </div>
                            {currentDoor.scontisticaModello > 0 && (
                              <div className="flex justify-between text-red-600">
                                <span>Sconto ({currentDoor.scontisticaModello}%):</span>
                                <span>-{formatCurrency((parseFloat(currentDoor.prezzoBaseModello) || 0) * (parseFloat(currentDoor.scontisticaModello) || 0) / 100)}</span>
                              </div>
                            )}
                            {currentDoor.prezzoFinitura > 0 && (
                              <div className="flex justify-between">
                                <span>Finitura:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.prezzoFinitura) || 0)}</span>
                              </div>
                            )}
                            {currentDoor.prezzoCerniere > 0 && (
                              <div className="flex justify-between">
                                <span>Cerniere:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.prezzoCerniere) || 0)}</span>
                              </div>
                            )}
                            {currentDoor.prezzoFerramenta > 0 && (
                              <div className="flex justify-between">
                                <span>Ferramenta:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.prezzoFerramenta) || 0)}</span>
                              </div>
                            )}
                            {currentDoor.fuoriMisuraLarghezza > 0 && (
                              <div className="flex justify-between">
                                <span>Fuori misura L:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.fuoriMisuraLarghezza) || 0)}</span>
                              </div>
                            )}
                            {currentDoor.fuoriMisuraAltezza > 0 && (
                              <div className="flex justify-between">
                                <span>Fuori misura A:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.fuoriMisuraAltezza) || 0)}</span>
                              </div>
                            )}
                            {currentDoor.fuoriMisuraSpessore > 0 && (
                              <div className="flex justify-between">
                                <span>Fuori misura S:</span>
                                <span>{formatCurrency(parseFloat(currentDoor.fuoriMisuraSpessore) || 0)}</span>
                              </div>
                            )}
                            <div className="flex justify-between pt-3 border-t border-gray-300 font-bold text-lg">
                              <span>Totale (x{currentDoor.quantita}):</span>
                              <span className="text-blue-600">{formatCurrency(calculateDoorPrice(currentDoor))}</span>
                            </div>
                          </div>
                        </div>
                      )}

                      <button
                        onClick={addDoor}
                        className="w-full bg-black text-white font-light py-4 px-8 hover:bg-gray-800 transition-colors uppercase tracking-wide text-sm"
                      >
                        Aggiungi porta
                      </button>
                    </div>
                  </div>

                  <div className="xl:col-span-1">
                    <div className="bg-white p-8 sticky top-8">
                      <h3 className="text-xl font-light text-black mb-2">Riepilogo</h3>
                      <div className="w-8 h-px bg-black mb-4"></div>
                      <p className="text-sm text-gray-600 mb-6">
                        {doors.length} {doors.length === 1 ? 'porta' : 'porte'}
                      </p>

                      {doors.length === 0 ? (
                        <p className="text-gray-400 font-light text-center py-12">Nessuna porta aggiunta</p>
                      ) : (
                        <div className="space-y-6 max-h-96 overflow-y-auto mb-6">
                          {doors.map((door, index) => (
                            <div key={door.id} className="border-b border-gray-200 pb-6">
                              <div className="flex justify-between items-start mb-3">
                                <h4 className="font-light text-black">Porta {index + 1}</h4>
                                <button
                                  onClick={() => removeDoor(door.id)}
                                  className="text-gray-400 hover:text-black transition-colors p-1"
                                >
                                  <span className="icon icon-trash"></span>
                                </button>
                              </div>
                              <div className="space-y-1 text-sm font-light text-gray-600">
                                <div>{door.posizione} ‚Ä¢ {door.stanza}</div>
                                <div>{door.modelloPorta}</div>
                                {door.larghezza && door.altezza && (
                                  <div>{door.larghezza} √ó {door.altezza} cm</div>
                                )}
                                <div>Qty: {door.quantita}</div>
                                <div className="text-blue-600 font-medium pt-2">
                                  {formatCurrency(calculateDoorPrice(door))}
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}

                      {doors.length > 0 && (
                        <div className="pt-6 border-t border-gray-200 mb-6">
                          <div className="space-y-2 text-sm">
                            <div className="flex justify-between">
                              <span>Subtotale porte:</span>
                              <span>{formatCurrency(doors.reduce((sum, door) => sum + calculateDoorPrice(door), 0))}</span>
                            </div>
                            
                            {orderInfo.costoTrasporto > 0 && (
                              <div className="flex justify-between">
                                <span>Trasporto:</span>
                                <span>{formatCurrency(parseFloat(orderInfo.costoTrasporto))}</span>
                              </div>
                            )}
                            
                            {orderInfo.altriExtra.length > 0 && (
                              <>
                                {orderInfo.altriExtra.map((extra, index) => (
                                  extra.prezzo > 0 && (
                                    <div key={extra.id} className="flex justify-between text-xs">
                                      <span className="truncate mr-2">{extra.descrizione || `Extra ${index + 1}`}:</span>
                                      <span>{formatCurrency(parseFloat(extra.prezzo))}</span>
                                    </div>
                                  )
                                ))}
                              </>
                            )}
                            
                            <div className="flex justify-between pt-3 border-t border-gray-300 font-bold text-lg">
                              <span>Totale generale:</span>
                              <span className="text-blue-600">{formatCurrency(calculateOrderTotal())}</span>
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="space-y-4">
                        <button
                          onClick={() => setShowPreview(true)}
                          disabled={doors.length === 0}
                          className="w-full border border-gray-300 text-black font-light py-3 px-6 hover:border-black disabled:border-gray-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors uppercase tracking-wide text-sm"
                        >
                          Anteprima
                        </button>
                        
                        <div className="flex items-center space-x-3 p-3 bg-gray-50 border border-gray-200">
                          <input
                            type="checkbox"
                            id="includePrices"
                            checked={includePricesInPDF}
                            onChange={(e) => setIncludePricesInPDF(e.target.checked)}
                            className="w-4 h-4 text-black border-gray-300 rounded focus:ring-black focus:ring-2"
                          />
                          <label htmlFor="includePrices" className="text-sm font-light text-black cursor-pointer">
                            Includi prezzi nel documento
                          </label>
                        </div>
                        
                        <button
                          onClick={() => generateOrder(includePricesInPDF)}
                          disabled={doors.length === 0}
                          className="w-full bg-black text-white font-light py-4 px-6 hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors uppercase tracking-wide text-sm"
                        >
                          {includePricesInPDF ? 'Genera Preventivo' : 'Genera Ordine Produzione'}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white p-8 mb-8 border border-gray-200">
                  <h2 className="text-2xl font-light text-black mb-6">Costi aggiuntivi</h2>
                  <div className="w-12 h-px bg-black mb-6"></div>
                  
                  <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-light text-black mb-3 uppercase tracking-wide">
                          Costo trasporto (‚Ç¨)
                        </label>
                        <input
                          type="number"
                          value={orderInfo.costoTrasporto}
                          onChange={(e) => handleOrderInfoChange('costoTrasporto', e.target.value)}
                          className="w-full p-4 border border-gray-300 focus:border-black focus:outline-none bg-white text-black"
                          placeholder="0.00"
                          step="0.01"
                        />
                      </div>
                    </div>

                    <div>
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="text-lg font-light text-black">Altri extra</h3>
                        <button
                          onClick={addExtraItem}
                          className="bg-gray-800 text-white font-light py-2 px-4 hover:bg-black transition-colors uppercase tracking-wide text-sm flex items-center"
                        >
                          <span className="icon icon-plus mr-2"></span>
                          Aggiungi extra
                        </button>
                      </div>

                      {orderInfo.altriExtra.length === 0 ? (
                        <p className="text-gray-500 font-light text-center py-8">
                          Nessun extra aggiunto
                        </p>
                      ) : (
                        <div className="space-y-4">
                          {orderInfo.altriExtra.map((extra, index) => (
                            <div key={extra.id} className="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 border border-gray-300 bg-gray-50">
                              <div className="md:col-span-2">
                                <label className="block text-xs font-light text-black mb-2 uppercase tracking-wide">
                                  Descrizione extra {index + 1}
                                </label>
                                <input
                                  type="text"
                                  value={extra.descrizione}
                                  onChange={(e) => updateExtraItem(extra.id, 'descrizione', e.target.value)}
                                  className="w-full p-3 border border-gray-300 focus:border-black focus:outline-none bg-white text-black text-sm"
                                  placeholder="es. Installazione, Lavorazione speciale..."
                                />
                              </div>
                              
                              <div className="flex gap-2">
                                <div className="flex-1">
                                  <label className="block text-xs font-light text-black mb-2 uppercase tracking-wide">
                                    Prezzo (‚Ç¨)
                                  </label>
                                  <input
                                    type="number"
                                    value={extra.prezzo}
                                    onChange={(e) => updateExtraItem(extra.id, 'prezzo', e.target.value)}
                                    className="w-full p-3 border border-gray-300 focus:border-black focus:outline-none bg-white text-black text-sm"
                                    placeholder="0.00"
                                    step="0.01"
                                  />
                                </div>
                                <div className="flex items-end">
                                  <button
                                    onClick={() => removeExtraItem(extra.id)}
                                    className="text-red-500 hover:text-red-700 hover:bg-red-100 p-2 rounded transition-colors"
                                  >
                                    <span className="icon icon-trash"></span>
                                  </button>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </div>

                {/* Modal anteprima */}
                {showPreview && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-8">
                    <div className="bg-white max-w-6xl w-full max-h-[90vh] overflow-hidden">
                      <div className="p-8 border-b border-gray-200 flex justify-between items-center">
                        <h2 className="text-xl font-light text-black">Anteprima preventivo</h2>
                        <button
                          onClick={() => setShowPreview(false)}
                          className="text-gray-400 hover:text-black transition-colors p-2"
                        >
                          <span className="icon icon-x"></span>
                        </button>
                      </div>
                      
                      <div className="p-8 overflow-y-auto max-h-[calc(90vh-120px)]">
                        <div className="space-y-6">
                          <div className="text-center border-b pb-6">
                            <div className="text-4xl font-light mb-2" style={{fontFamily: 'serif'}}>twe</div>
                            <div className="text-xs tracking-widest uppercase mb-4">TUCCI WOOD ESSENCE</div>
                            <div className="text-xl">PREVENTIVO/ORDINE PORTE DA INTERNO</div>
                          </div>

                          <div className="grid grid-cols-2 gap-8 bg-gray-50 p-6">
                            <div>
                              <h4 className="text-sm uppercase mb-3 text-gray-600">Dati Ordine</h4>
                              <div className="space-y-1 text-sm">
                                <div><strong>Commessa:</strong> {orderInfo.nomeCommessa || '[Da completare]'}</div>
                                <div><strong>Numero:</strong> {orderInfo.numeroOrdine || 'TWE-' + Date.now()}</div>
                                <div><strong>Agente:</strong> {orderInfo.nomeAgente || '[Da completare]'}</div>
                                <div><strong>Data:</strong> {new Date().toLocaleDateString('it-IT')}</div>
                              </div>
                            </div>
                            <div>
                              <h4 className="text-sm uppercase mb-3 text-gray-600">Dati Cliente</h4>
                              <div className="space-y-1 text-sm">
                                <div><strong>Cliente:</strong> {orderInfo.nomeCliente || '[Da completare]'}</div>
                                <div><strong>Indirizzo:</strong> {orderInfo.indirizzoConsegna || '[Da completare]'}</div>
                                <div><strong>P.IVA:</strong> {orderInfo.partitaIva || '[Da completare]'}</div>
                              </div>
                            </div>
                          </div>

                          <div className="space-y-4">
                            {doors.map((door, index) => (
                              <div key={door.id} className="border border-gray-300 p-6">
                                <div className="flex justify-between items-center mb-4 pb-2 border-b">
                                  <h4 className="text-lg font-bold">PORTA {index + 1}</h4>
                                  <span className="text-blue-600 font-bold">{formatCurrency(calculateDoorPrice(door))}</span>
                                </div>
                                <div className="grid grid-cols-3 gap-6">
                                  <div className="col-span-2 space-y-2 text-sm">
                                    <div className="flex justify-between"><span className="text-gray-600">Posizione:</span><span>{door.posizione}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-600">Stanza:</span><span>{door.stanza}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-600">Modello:</span><span>{door.modelloPorta}</span></div>
                                    {door.finitura && <div className="flex justify-between"><span className="text-gray-600">Finitura:</span><span>{door.finitura}</span></div>}
                                    {door.larghezza && door.altezza && <div className="flex justify-between"><span className="text-gray-600">Dimensioni:</span><span>{door.larghezza} √ó {door.altezza} cm</span></div>}
                                    <div className="flex justify-between"><span className="text-gray-600">Quantit√†:</span><span>{door.quantita}</span></div>
                                  </div>
                                  <div className="bg-gray-50 p-4 text-sm">
                                    <h5 className="text-xs uppercase text-gray-600 mb-2">Dettaglio Prezzi</h5>
                                    <div className="space-y-1">
                                      <div className="flex justify-between"><span>Base:</span><span>{formatCurrency(parseFloat(door.prezzoBaseModello) || 0)}</span></div>
                                      {door.scontisticaModello > 0 && (
                                        <div className="flex justify-between text-red-600">
                                          <span>Sconto:</span>
                                          <span>-{formatCurrency((parseFloat(door.prezzoBaseModello) || 0) * (parseFloat(door.scontisticaModello) || 0) / 100)}</span>
                                        </div>
                                      )}
                                      {door.prezzoFinitura > 0 && <div className="flex justify-between"><span>Finitura:</span><span>{formatCurrency(parseFloat(door.prezzoFinitura) || 0)}</span></div>}
                                      {door.prezzoCerniere > 0 && <div className="flex justify-between"><span>Cerniere:</span><span>{formatCurrency(parseFloat(door.prezzoCerniere) || 0)}</span></div>}
                                      {door.prezzoFerramenta > 0 && <div className="flex justify-between"><span>Ferramenta:</span><span>{formatCurrency(parseFloat(door.prezzoFerramenta) || 0)}</span></div>}
                                      {door.fuoriMisuraLarghezza > 0 && <div className="flex justify-between"><span>Fuori mis. L:</span><span>{formatCurrency(parseFloat(door.fuoriMisuraLarghezza) || 0)}</span></div>}
                                      {door.fuoriMisuraAltezza > 0 && <div className="flex justify-between"><span>Fuori mis. A:</span><span>{formatCurrency(parseFloat(door.fuoriMisuraAltezza) || 0)}</span></div>}
                                      {door.fuoriMisuraSpessore > 0 && <div className="flex justify-between"><span>Fuori mis. S:</span><span>{formatCurrency(parseFloat(door.fuoriMisuraSpessore) || 0)}</span></div>}
                                      <div className="flex justify-between pt-2 border-t font-bold text-blue-600">
                                        <span>Totale:</span>
                                        <span>{formatCurrency(calculateDoorPrice(door))}</span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>

                          <div className="bg-gray-100 p-6 border-2 border-gray-300">
                            <div className="space-y-3">
                              <div className="flex justify-between text-lg">
                                <span>Subtotale porte:</span>
                                <span>{formatCurrency(doors.reduce((sum, door) => sum + calculateDoorPrice(door), 0))}</span>
                              </div>
                              {orderInfo.costoTrasporto > 0 && (
                                <div className="flex justify-between">
                                  <span>Trasporto:</span>
                                  <span>{formatCurrency(parseFloat(orderInfo.costoTrasporto))}</span>
                                </div>
                              )}
                              {orderInfo.altriExtra.length > 0 && (
                                <>
                                  {orderInfo.altriExtra.map((extra, index) => (
                                    extra.prezzo > 0 && (
                                      <div key={extra.id} className="flex justify-between">
                                        <span>{extra.descrizione || `Extra ${index + 1}`}:</span>
                                        <span>{formatCurrency(parseFloat(extra.prezzo))}</span>
                                      </div>
                                    )
                                  ))}
                                </>
                              )}
                              <div className="flex justify-between text-2xl font-bold pt-3 border-t-2 border-black text-blue-600">
                                <span>TOTALE GENERALE:</span>
                                <span>{formatCurrency(calculateOrderTotal())}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DoorOrderGenerator />);
    </script>
</body>
</html>
